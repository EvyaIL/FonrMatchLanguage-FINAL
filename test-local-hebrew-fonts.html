<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Hebrew Fonts Test</title>
    <script src="js/fonts.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            direction: ltr;
        }
        .stats {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .font-test {
            margin: 15px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        .font-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        .font-meta {
            color: #666;
            font-size: 12px;
            margin-bottom: 10px;
        }
        .hebrew-text {
            font-size: 18px;
            margin: 8px 0;
            padding: 8px;
            background: #f9f9f9;
            border-radius: 4px;
            direction: rtl;
        }
        .english-text {
            font-size: 16px;
            margin: 8px 0;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 4px;
            direction: ltr;
        }
        .font-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #666;
        }
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #e8f5e8;
            color: #2e7d2e;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üî§ Local Hebrew Fonts Test</h1>
    
    <div id="loading" class="loading">
        <p>Loading and testing local font collection...</p>
    </div>
    
    <div id="results" style="display: none;">
        <div id="stats" class="stats"></div>
        <div id="errors"></div>
        <div id="fonts-grid" class="font-grid"></div>
    </div>

    <script>
        const hebrewSample = "◊©◊ú◊ï◊ù ◊¢◊ï◊ú◊ù! ◊ê◊ë◊í◊ì ◊î◊ï◊ñ◊ó ◊ò◊ô◊õ◊ú ◊û◊†◊°◊¢ ◊§◊¶◊ß◊® ◊©◊™◊• 1234567890";
        const englishSample = "Hello World! The quick brown fox jumps over the lazy dog 1234567890";

        async function testLocalFonts() {
            try {
                const fm = new FontManager();
                await fm.initialize();
                
                const statsDiv = document.getElementById('stats');
                const errorsDiv = document.getElementById('errors');
                const fontsGrid = document.getElementById('fonts-grid');
                const loadingDiv = document.getElementById('loading');
                const resultsDiv = document.getElementById('results');
                
                // Show statistics
                const hebrewFonts = fm.hebrewFonts;
                const englishFonts = fm.englishFonts;
                const totalLocal = fm.allLocalFonts?.length || 0;
                
                statsDiv.innerHTML = `
                    <h2>üìä Font Collection Statistics</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><strong>Hebrew Fonts:</strong> ${hebrewFonts.length}</div>
                        <div><strong>English Fonts:</strong> ${englishFonts.length}</div>
                        <div><strong>Total Local:</strong> ${totalLocal}</div>
                        <div><strong>Fonts Loaded:</strong> ${fm.fontsLoaded ? '‚úÖ Yes' : '‚ùå No'}</div>
                    </div>
                `;
                
                // Test if local fonts are properly loaded
                if (totalLocal === 0) {
                    errorsDiv.innerHTML = `
                        <div class="error">
                            <strong>‚ö†Ô∏è No local fonts detected!</strong><br>
                            The system may have fallen back to manual font definitions.
                            Please check if the fonts-compact.json file exists and is accessible.
                        </div>
                    `;
                } else {
                    errorsDiv.innerHTML = `
                        <div class="success">
                            <strong>‚úÖ Local fonts successfully loaded!</strong><br>
                            Found ${totalLocal} local fonts (${hebrewFonts.filter(f => f.file).length} Hebrew with files, 
                            ${englishFonts.filter(f => f.file).length} English with files).
                        </div>
                    `;
                }
                
                // Test Hebrew fonts (first 50 for performance)
                const testFonts = hebrewFonts.slice(0, 50);
                console.log(`Testing ${testFonts.length} Hebrew fonts...`);
                
                for (const font of testFonts) {
                    const fontDiv = document.createElement('div');
                    fontDiv.className = 'font-test';
                    
                    // Load the font if it has a file
                    if (font.file && fm.loadFontFile) {
                        try {
                            await fm.loadFontFile(font);
                        } catch (error) {
                            console.warn(`Failed to load font file for ${font.name}:`, error);
                        }
                    }
                    
                    fontDiv.innerHTML = `
                        <div class="font-name">${font.name}</div>
                        <div class="font-meta">
                            ${font.category || 'unknown'} | ${font.style || 'unknown'} | ${font.weight || 'unknown'}
                            ${font.file ? ` | üìÅ ${font.file}` : ' | ‚ö†Ô∏è No file'}
                        </div>
                        <div class="hebrew-text" style="font-family: '${font.name}', Arial, sans-serif;">
                            ${hebrewSample}
                        </div>
                        <div class="english-text" style="font-family: '${font.name}', Arial, sans-serif;">
                            ${englishSample}
                        </div>
                    `;
                    
                    fontsGrid.appendChild(fontDiv);
                }
                
                loadingDiv.style.display = 'none';
                resultsDiv.style.display = 'block';
                
                console.log('‚úÖ Font testing completed successfully!');
                
            } catch (error) {
                console.error('‚ùå Error during font testing:', error);
                document.getElementById('errors').innerHTML = `
                    <div class="error">
                        <strong>‚ùå Error during font testing:</strong><br>
                        ${error.message}
                    </div>
                `;
                document.getElementById('loading').style.display = 'none';
                document.getElementById('results').style.display = 'block';
            }
        }
        
        // Start testing when page loads
        testLocalFonts();
    </script>
</body>
</html>
